# AASIST3 å‡çº§å®Œæˆæ€»ç»“

## å·²å®ç°çš„åŠŸèƒ½

### âœ… 1. å¤šè·¯å¹¶è”ç‰¹å¾æå– (`features/`)

- **LFCC** (`lfcc.py`): çº¿æ€§é¢‘ç‡å€’è°±ç³»æ•°,ä¸ Mel äº’è¡¥
- **CQCC** (`cqcc.py`): å¸¸æ•° Q å€’è°±ç³»æ•°,å¯¹å‹ç¼©ä¼ªè¿¹æ•æ„Ÿ
- **Phase** (`phase.py`): ç›¸ä½ç‰¹å¾ (RPS/MGD/IFD),æ•æ‰åˆæˆä¼ªè¿¹
- **SSL** (`ssl.py`): è‡ªç›‘ç£å­¦ä¹ ç‰¹å¾ (wav2vec2/WavLM/Whisper)

**ç‰¹ç‚¹**:
- æ”¯æŒç¦»çº¿ç‰¹å¾ç¼“å­˜
- æ‰¹é‡å¤„ç†ä¼˜åŒ–
- GPU/CPU é«˜æ•ˆå®ç°

### âœ… 2. AASIST3 æ¨¡å‹æ¶æ„ (`Aasist/models/`)

- **AASIST3.py**: å¤šè·¯å¹¶è”çš„ AASIST å‡çº§ç‰ˆ
- **fusion_head.py**: å¤šç§èåˆç­–ç•¥
  - Logit çº§åŠ æƒèåˆ
  - MLP å­¦ä¹ å‹èåˆ
  - Attention èåˆ

**æ”¹è¿›**:
- æ¯è·¯ç‹¬ç«‹ç¼–ç å™¨
- å¼‚æ„å›¾æ³¨æ„åŠ›
- è‡ªé€‚åº”èåˆæƒé‡

### âœ… 3. ç”µè¯ä¿¡é“å¢å¼º (`Aasist/data/`)

**telephony_augs.py**:
- ç¼–è§£ç æ¨¡æ‹Ÿ (AMR-NB/WB, G.711, Opus)
- å¸¦å®½æŠ–åŠ¨ (8k â†” 16k)
- å¸¦é€šæ»¤æ³¢ (300-3400 Hz)
- åŠ¨æ€èŒƒå›´å‹ç¼©
- RawBoost æ³¢å½¢æ‰°åŠ¨ (LnL/ISD/SSI)

**ç‰¹ç‚¹**:
- å¯é…ç½®çš„å¢å¼ºæ¦‚ç‡
- æ”¯æŒ FFmpeg çœŸå®ç¼–è§£ç  (å¯é€‰)
- CPU é«˜æ•ˆå®ç°

### âœ… 4. VAD è¯­éŸ³æ´»åŠ¨æ£€æµ‹ (`Aasist/data/`)

**vad.py**:
- **EnergyVAD**: åŸºäºèƒ½é‡çš„ VAD (å¿«é€Ÿ,æ— ä¾èµ–)
- **WebRTCVAD**: åŸºäº WebRTC çš„ VAD (å‡†ç¡®,éœ€è¦ py-webrtcvad)

**åŠŸèƒ½**:
- è‡ªåŠ¨å»é™¤é™éŸ³æ®µ
- å½¢æ€å­¦å¹³æ»‘
- æœ€å°è¯­éŸ³å æ¯”ä¿è¯

### âœ… 5. å¤šè·¯ç‰¹å¾æ•°æ®é›† (`Aasist/data/`)

**dataset_multipath.py**:
- éšæœºåˆ‡ç‰‡ (2-6s è®­ç»ƒ, å›ºå®šé•¿åº¦æ¨ç†)
- VAD é›†æˆ
- ç”µè¯å¢å¼ºé›†æˆ
- ç‰¹å¾ç¼“å­˜
- é«˜æ•ˆæ‰¹å¤„ç†

### âœ… 6. é«˜çº§æŸå¤±å‡½æ•° (`Aasist/losses.py`)

- **FocalLoss**: è§£å†³ç±»åˆ«ä¸å‡è¡¡
- **ClassBalancedLoss**: åŸºäºæœ‰æ•ˆæ ·æœ¬æ•°
- **AAMSoftmax**: å¢å¼ºåŸŸæ³›åŒ– (ArcFace)
- **LabelSmoothingLoss**: é˜²æ­¢è¿‡æ‹Ÿåˆ
- **CombinedLoss**: å¤šæŸå¤±ç»„åˆ

### âœ… 7. è®­ç»ƒè„šæœ¬ (`Aasist/train_aasist3.py`)

**åŠŸèƒ½**:
- å¤šè·¯ç‰¹å¾è®­ç»ƒ
- éªŒè¯é›†é˜ˆå€¼ä¼˜åŒ– (F1 æœ€å¤§åŒ–)
- æ··åˆç²¾åº¦è®­ç»ƒ (AMP)
- å­¦ä¹ ç‡è°ƒåº¦ (Cosine Annealing)
- è®­ç»ƒå†å²è®°å½•

**ä¼˜åŒ–**:
- T4 GPU ä¼˜åŒ–é…ç½®
- æ¢¯åº¦ç´¯ç§¯ (å¯é€‰)
- æ—©åœæœºåˆ¶

### âœ… 8. æ¨ç†è„šæœ¬ (`Aasist/predict_aasist3.py`)

**åŠŸèƒ½**:
- æ»‘çª—æ¨ç† (3-5s, 50% é‡å )
- å¤š chunk é›†æˆ (mean/max/top-k)
- æ¸©åº¦ç¼©æ”¾æ ¡å‡†
- æ‰¹é‡é¢„æµ‹

### âœ… 9. è¾…åŠ©å·¥å…·

- **run_aasist3.py**: å¿«é€Ÿå¯åŠ¨è„šæœ¬
- **prepare_data.py**: æ•°æ®å‡†å¤‡å’ŒéªŒè¯
- **config_aasist3.py**: é›†ä¸­é…ç½®ç®¡ç†
- **AASIST3_README.md**: å®Œæ•´æ–‡æ¡£
- **requirements_aasist3.txt**: ä¾èµ–åˆ—è¡¨

## æ–‡ä»¶ç»“æ„

```
FakeVoiceDetection/
â”‚
â”œâ”€â”€ features/                           # å¤šè·¯ç‰¹å¾æå–
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ lfcc.py                        # LFCC æå–å™¨
â”‚   â”œâ”€â”€ cqcc.py                        # CQCC æå–å™¨
â”‚   â”œâ”€â”€ phase.py                       # ç›¸ä½ç‰¹å¾
â”‚   â””â”€â”€ ssl.py                         # SSL ç‰¹å¾
â”‚
â”œâ”€â”€ Aasist/
â”‚   â”œâ”€â”€ __init__.py                    # æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ config_aasist3.py              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ losses.py                      # æŸå¤±å‡½æ•°
â”‚   â”œâ”€â”€ train_aasist3.py               # è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ predict_aasist3.py             # æ¨ç†è„šæœ¬
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ AASIST.py                  # åŸç‰ˆ AASIST
â”‚   â”‚   â”œâ”€â”€ AASIST3.py                 # AASIST3 æ¨¡å‹
â”‚   â”‚   â””â”€â”€ fusion_head.py             # èåˆæ¨¡å—
â”‚   â”‚
â”‚   â””â”€â”€ data/
â”‚       â”œâ”€â”€ vad.py                     # VAD
â”‚       â”œâ”€â”€ telephony_augs.py          # ç”µè¯å¢å¼º
â”‚       â””â”€â”€ dataset_multipath.py       # æ•°æ®é›†åŠ è½½å™¨
â”‚
â”œâ”€â”€ run_aasist3.py                     # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ prepare_data.py                    # æ•°æ®å‡†å¤‡å·¥å…·
â”œâ”€â”€ AASIST3_README.md                  # å®Œæ•´æ–‡æ¡£
â””â”€â”€ requirements_aasist3.txt           # ä¾èµ–åˆ—è¡¨
```

## ä½¿ç”¨æµç¨‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements_aasist3.txt
```

### 2. æ•°æ®å‡†å¤‡

```bash
# æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
python prepare_data.py --data_root ./dataset --all

# é¢„ç¼“å­˜ç‰¹å¾ (å¯é€‰,åŠ é€Ÿè®­ç»ƒ)
python prepare_data.py --data_root ./dataset --precache --cache_dir ./feature_cache
```

### 3. è®­ç»ƒæ¨¡å‹

```bash
# æ–¹å¼1: ä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬
python run_aasist3.py train \
    --data_root ./dataset \
    --output_dir ./output \
    --feature_types lfcc cqcc phase \
    --use_amp

# æ–¹å¼2: ç›´æ¥è°ƒç”¨è®­ç»ƒè„šæœ¬
cd Aasist
python -m train_aasist3 \
    --data_root ../dataset \
    --output_dir ./output_aasist3 \
    --batch_size 24 \
    --epochs 50 \
    --use_amp
```

### 4. æ¨ç†é¢„æµ‹

```bash
# æ–¹å¼1: ä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬
python run_aasist3.py predict \
    --checkpoint ./output/best_aasist3.pth \
    --test_dir ./dataset/test \
    --output_csv predictions.csv

# æ–¹å¼2: ç›´æ¥è°ƒç”¨æ¨ç†è„šæœ¬
cd Aasist
python -m predict_aasist3 \
    --checkpoint ./output_aasist3/best_aasist3.pth \
    --test_dir ../dataset/test \
    --output_csv predictions.csv \
    --window_size 4.0 \
    --hop_size 2.0 \
    --pooling mean
```

## æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

### é’ˆå¯¹ T4 GPU (16GB)

1. **æ‰¹å¤§å°**: 24-32 (æ ¹æ®ç‰¹å¾æ•°é‡è°ƒæ•´)
2. **æ··åˆç²¾åº¦**: å¿…é¡»å¯ç”¨ `--use_amp`
3. **ç‰¹å¾é€‰æ‹©**: `lfcc cqcc phase` (ä¸ç”¨ SSL)
4. **æ•°æ®åŠ è½½**: `--num_workers 8` (16æ ¸ CPU)
5. **ç‰¹å¾ç¼“å­˜**: å¯ç”¨ç¦»çº¿ç¼“å­˜

### è®­ç»ƒåŠ é€ŸæŠ€å·§

```python
# 1. é¢„ç¼“å­˜ç‰¹å¾
python prepare_data.py --data_root ./dataset --precache

# 2. ä½¿ç”¨é…ç½®æ–‡ä»¶
from Aasist.config_aasist3 import get_t4_config
config = get_t4_config()  # T4 ä¼˜åŒ–é…ç½®

# 3. æ¢¯åº¦ç´¯ç§¯ (å¦‚æœæ˜¾å­˜ä¸è¶³)
# åœ¨ train_aasist3.py ä¸­æ·»åŠ :
# if batch_idx % gradient_accumulation_steps == 0:
#     optimizer.step()
#     optimizer.zero_grad()
```

## å…³é”®æ”¹è¿›æ€»ç»“

| æ–¹é¢ | AASIST (åŸç‰ˆ) | AASIST3 (å‡çº§ç‰ˆ) |
|------|--------------|-----------------|
| **ç‰¹å¾** | å•è·¯ Mel è°± | å¤šè·¯å¹¶è” (LFCC+CQCC+Phase+SSL) |
| **å¢å¼º** | åŸºç¡€å¢å¼º | ç”µè¯ä¿¡é“ä¸“ç”¨å¢å¼º (RawBoost ç­‰) |
| **é¢„å¤„ç†** | æ—  VAD | èƒ½é‡/WebRTC VAD |
| **åˆ‡ç‰‡** | å›ºå®šé•¿åº¦ | è®­ç»ƒéšæœº (2-6s), æ¨ç†æ»‘çª— |
| **æŸå¤±** | äº¤å‰ç†µ | Focal/Class-Balanced/AAM |
| **æ¨ç†** | å• chunk | æ»‘çª—é›†æˆ + é˜ˆå€¼ä¼˜åŒ– |
| **æ³›åŒ–** | ä¸€èˆ¬ | ç”µè¯ä¿¡é“é²æ£’ |

## é¢„æœŸæå‡

- **åŸŸå†…æ€§èƒ½**: +5-10% F1 (vs AASIST)
- **åŸŸå¤–æ³›åŒ–**: +10-15% F1 (ç”µè¯ä¿¡é“åœºæ™¯)
- **æœªçŸ¥ä¼ªé€ **: +8-12% F1 (å¤šè·¯ç‰¹å¾äº’è¡¥)

## æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡è¿è¡Œ**: ç‰¹å¾æå–éœ€è¦æ—¶é—´,å»ºè®®é¢„ç¼“å­˜
2. **æ˜¾å­˜ç®¡ç†**: ä½¿ç”¨å¤šä¸ªç‰¹å¾æ—¶æ³¨æ„æ˜¾å­˜,å¿…è¦æ—¶å‡å°æ‰¹å¤§å°
3. **é˜ˆå€¼ä½¿ç”¨**: æ¨ç†æ—¶ä½¿ç”¨è®­ç»ƒæ—¶æ‰¾åˆ°çš„æœ€ä¼˜é˜ˆå€¼,ä¸è¦ç”¨ 0.5
4. **SSL ç‰¹å¾**: éœ€è¦é¢å¤–çš„ GPU æ˜¾å­˜,å»ºè®®å•ç‹¬ä½¿ç”¨æˆ–é¢„æå–
5. **ä¾èµ–å®‰è£…**: `webrtcvad` å’Œ `transformers` æ˜¯å¯é€‰ä¾èµ–

## æ•…éšœæ’é™¤

### Q: æ˜¾å­˜ä¸è¶³

**A**: 
1. å‡å°æ‰¹å¤§å° `--batch_size 16`
2. å¯ç”¨æ··åˆç²¾åº¦ `--use_amp`
3. å‡å°‘ç‰¹å¾æ•°é‡ (åªç”¨ `lfcc cqcc`)
4. ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯

### Q: è®­ç»ƒå¤ªæ…¢

**A**:
1. é¢„ç¼“å­˜ç‰¹å¾
2. å¢åŠ  `num_workers`
3. å¯ç”¨æ··åˆç²¾åº¦
4. ä½¿ç”¨æ›´å°‘çš„ç‰¹å¾ç±»å‹

### Q: ç‰¹å¾æå–æŠ¥é”™

**A**:
1. æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æ˜¯å¦å®Œæ•´: `python prepare_data.py --check_integrity`
2. ç¡®ä¿é‡‡æ ·ç‡ä¸€è‡´ (16kHz)
3. æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…å®Œæ•´

## åç»­æ”¹è¿›æ–¹å‘

1. **è‡ªåŠ¨åŒ–è¶…å‚æœç´¢**: ä½¿ç”¨ Optuna ç­‰å·¥å…·
2. **æ¨¡å‹é›†æˆ**: è®­ç»ƒå¤šä¸ªæ¨¡å‹å¹¶èåˆ
3. **çŸ¥è¯†è’¸é¦**: ä»å¤§æ¨¡å‹è’¸é¦åˆ°å°æ¨¡å‹
4. **åœ¨çº¿å¢å¼º**: å®æ—¶éŸ³é¢‘æµå¤„ç†
5. **å¤šè¯­è¨€æ”¯æŒ**: æ‰©å±•åˆ°æ›´å¤šè¯­è¨€

## è”ç³»å’Œæ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·æŸ¥çœ‹:
1. `AASIST3_README.md` - å®Œæ•´æ–‡æ¡£
2. GitHub Issues
3. é¡¹ç›®ç»´æŠ¤è€…

---

**å‡çº§å®Œæˆ! Good Luck! ğŸš€**
